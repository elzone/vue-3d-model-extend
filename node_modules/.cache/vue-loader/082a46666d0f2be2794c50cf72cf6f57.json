{"remainingRequest":"/Users/alex/Projects Sources/Elucidly/vue-3d-model-extend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/alex/Projects Sources/Elucidly/vue-3d-model-extend/src/model-obj.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/alex/Projects Sources/Elucidly/vue-3d-model-extend/src/model-obj.vue","mtime":1638514315000},{"path":"/Users/alex/Projects Sources/Elucidly/vue-3d-model-extend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/alex/Projects Sources/Elucidly/vue-3d-model-extend/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/alex/Projects Sources/Elucidly/vue-3d-model-extend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/alex/Projects Sources/Elucidly/vue-3d-model-extend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IE9CSkxvYWRlciB9IGZyb20gJ3RocmVlL2V4YW1wbGVzL2pzbS9sb2FkZXJzL09CSkxvYWRlcic7CmltcG9ydCB7IE1UTExvYWRlciB9IGZyb20gJ3RocmVlL2V4YW1wbGVzL2pzbS9sb2FkZXJzL01UTExvYWRlcic7CmltcG9ydCB7IEREU0xvYWRlciB9IGZyb20gJ3RocmVlL2V4YW1wbGVzL2pzbS9sb2FkZXJzL0REU0xvYWRlcic7CmltcG9ydCB7IExvYWRpbmdNYW5hZ2VyIH0gZnJvbSAndGhyZWUvc3JjL2xvYWRlcnMvTG9hZGluZ01hbmFnZXInOwppbXBvcnQgeyB0b0luZGV4ZWQgfSBmcm9tICcuL3V0aWwnOwppbXBvcnQgbWl4aW4gZnJvbSAnLi9tb2RlbC1taXhpbi52dWUnOwoKLy8gVE9ETzogQmV0dGVyIHdheSB0byBoYW5kbGUgdGV4dHVyZSBmb3JtYXRzCmNvbnN0IG1hbmFnZXIgPSAobmV3IExvYWRpbmdNYW5hZ2VyKCkpOyAvLyAwLjEyMisgbmV3IGFwaQptYW5hZ2VyLmFkZEhhbmRsZXIoL1wuZGRzJC9pLCBuZXcgRERTTG9hZGVyKCkpOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdtb2RlbC1vYmonLAogIG1peGluczogW21peGluXSwKICBwcm9wczogewogICAgbGlnaHRzOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHR5cGU6ICdIZW1pc3BoZXJlTGlnaHQnLAogICAgICAgICAgICBwb3NpdGlvbjogeyB4OiAwLCB5OiAxLCB6OiAwIH0sCiAgICAgICAgICAgIHNreUNvbG9yOiAweGFhYWFmZiwKICAgICAgICAgICAgZ3JvdW5kQ29sb3I6IDB4ODA2MDYwLAogICAgICAgICAgICBpbnRlbnNpdHk6IDAuMiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIHR5cGU6ICdEaXJlY3Rpb25hbExpZ2h0JywKICAgICAgICAgICAgcG9zaXRpb246IHsgeDogMSwgeTogMSwgejogMSB9LAogICAgICAgICAgICBjb2xvcjogMHhmZmZmZmYsCiAgICAgICAgICAgIGludGVuc2l0eTogMC44LAogICAgICAgICAgfSwKICAgICAgICBdOwogICAgICB9LAogICAgfSwKICAgIHNtb290aGluZzogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgIH0sCiAgICBtdGxQYXRoOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgIH0sCiAgICBtdGw6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICBjb25zdCBvYmpMb2FkZXIgPSBuZXcgT0JKTG9hZGVyKG1hbmFnZXIpOwogICAgY29uc3QgbXRsTG9hZGVyID0gbmV3IE1UTExvYWRlcihtYW5hZ2VyKTsKCiAgICBtdGxMb2FkZXIuc2V0Q3Jvc3NPcmlnaW4odGhpcy5jcm9zc09yaWdpbik7CiAgICBtdGxMb2FkZXIuc2V0UmVxdWVzdEhlYWRlcih0aGlzLnJlcXVlc3RIZWFkZXIpOwogICAgb2JqTG9hZGVyLnNldFJlcXVlc3RIZWFkZXIodGhpcy5yZXF1ZXN0SGVhZGVyKTsKCiAgICByZXR1cm4gewogICAgICBsb2FkZXI6IG9iakxvYWRlciwKICAgICAgbXRsTG9hZGVyLAogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICBtdGwoKSB7CiAgICAgIHRoaXMubG9hZCgpOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIHByb2Nlc3Mob2JqZWN0KSB7CiAgICAgIGlmICh0aGlzLnNtb290aGluZykgewogICAgICAgIG9iamVjdC50cmF2ZXJzZSgoY2hpbGQpID0+IHsKICAgICAgICAgIGlmIChjaGlsZC5nZW9tZXRyeSkgewogICAgICAgICAgICBjaGlsZC5nZW9tZXRyeSA9IHRvSW5kZXhlZChjaGlsZC5nZW9tZXRyeSk7CiAgICAgICAgICAgIGNoaWxkLmdlb21ldHJ5LmNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkKCkgewogICAgICBpZiAoIXRoaXMuc3JjKSByZXR1cm47CgogICAgICBpZiAodGhpcy5vYmplY3QpIHsKICAgICAgICB0aGlzLndyYXBwZXIucmVtb3ZlKHRoaXMub2JqZWN0KTsKICAgICAgfQoKICAgICAgY29uc3Qgb25Mb2FkID0gKG9iamVjdCkgPT4gewogICAgICAgIGlmICh0aGlzLnByb2Nlc3MpIHsKICAgICAgICAgIHRoaXMucHJvY2VzcyhvYmplY3QpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5hZGRPYmplY3Qob2JqZWN0KTsKCiAgICAgICAgdGhpcy4kZW1pdCgnb24tbG9hZCcpOwogICAgICB9OwoKICAgICAgY29uc3Qgb25Qcm9ncmVzcyA9ICh4aHIpID0+IHsKICAgICAgICB0aGlzLiRlbWl0KCdvbi1wcm9ncmVzcycsIHhocik7CiAgICAgIH07CgogICAgICBjb25zdCBvbkVycm9yID0gKGVycikgPT4gewogICAgICAgIHRoaXMuJGVtaXQoJ29uLWVycm9yJywgZXJyKTsKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLm10bCkgewogICAgICAgIGxldCB7IG10bFBhdGggfSA9IHRoaXM7CiAgICAgICAgbGV0IG10bFNyYyA9IHRoaXMubXRsOwoKICAgICAgICBpZiAoIXRoaXMubXRsUGF0aCkgewogICAgICAgICAgY29uc3QgcmVzdWx0ID0gL14oLipcLykoW14vXSopJC8uZXhlYyh0aGlzLm10bCk7CgogICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICBtdGxQYXRoID0gcmVzdWx0WzFdOwogICAgICAgICAgICBtdGxTcmMgPSByZXN1bHRbMl07CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobXRsUGF0aCkgewogICAgICAgICAgdGhpcy5tdGxMb2FkZXIuc2V0UGF0aChtdGxQYXRoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMubXRsTG9hZGVyLmxvYWQobXRsU3JjLCAobWF0ZXJpYWxzKSA9PiB7CiAgICAgICAgICBtYXRlcmlhbHMucHJlbG9hZCgpOwoKICAgICAgICAgIHRoaXMubG9hZGVyCiAgICAgICAgICAgIC5zZXRNYXRlcmlhbHMobWF0ZXJpYWxzKQogICAgICAgICAgICAubG9hZCh0aGlzLnNyYywgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yKTsKICAgICAgICB9LCAoKSA9PiB7fSwgb25FcnJvcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkZXIubG9hZCh0aGlzLnNyYywgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yKTsKICAgICAgfQogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["model-obj.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"model-obj.vue","sourceRoot":"src","sourcesContent":["<script>\nimport { OBJLoader } from 'three/examples/jsm/loaders/OBJLoader';\nimport { MTLLoader } from 'three/examples/jsm/loaders/MTLLoader';\nimport { DDSLoader } from 'three/examples/jsm/loaders/DDSLoader';\nimport { LoadingManager } from 'three/src/loaders/LoadingManager';\nimport { toIndexed } from './util';\nimport mixin from './model-mixin.vue';\n\n// TODO: Better way to handle texture formats\nconst manager = (new LoadingManager()); // 0.122+ new api\nmanager.addHandler(/\\.dds$/i, new DDSLoader());\n\nexport default {\n  name: 'model-obj',\n  mixins: [mixin],\n  props: {\n    lights: {\n      type: Array,\n      default() {\n        return [\n          {\n            type: 'HemisphereLight',\n            position: { x: 0, y: 1, z: 0 },\n            skyColor: 0xaaaaff,\n            groundColor: 0x806060,\n            intensity: 0.2,\n          },\n          {\n            type: 'DirectionalLight',\n            position: { x: 1, y: 1, z: 1 },\n            color: 0xffffff,\n            intensity: 0.8,\n          },\n        ];\n      },\n    },\n    smoothing: {\n      type: Boolean,\n      default: false,\n    },\n    mtlPath: {\n      type: String,\n    },\n    mtl: {\n      type: String,\n    },\n  },\n  data() {\n    const objLoader = new OBJLoader(manager);\n    const mtlLoader = new MTLLoader(manager);\n\n    mtlLoader.setCrossOrigin(this.crossOrigin);\n    mtlLoader.setRequestHeader(this.requestHeader);\n    objLoader.setRequestHeader(this.requestHeader);\n\n    return {\n      loader: objLoader,\n      mtlLoader,\n    };\n  },\n  watch: {\n    mtl() {\n      this.load();\n    },\n  },\n  methods: {\n    process(object) {\n      if (this.smoothing) {\n        object.traverse((child) => {\n          if (child.geometry) {\n            child.geometry = toIndexed(child.geometry);\n            child.geometry.computeVertexNormals();\n          }\n        });\n      }\n    },\n    load() {\n      if (!this.src) return;\n\n      if (this.object) {\n        this.wrapper.remove(this.object);\n      }\n\n      const onLoad = (object) => {\n        if (this.process) {\n          this.process(object);\n        }\n\n        this.addObject(object);\n\n        this.$emit('on-load');\n      };\n\n      const onProgress = (xhr) => {\n        this.$emit('on-progress', xhr);\n      };\n\n      const onError = (err) => {\n        this.$emit('on-error', err);\n      };\n\n      if (this.mtl) {\n        let { mtlPath } = this;\n        let mtlSrc = this.mtl;\n\n        if (!this.mtlPath) {\n          const result = /^(.*\\/)([^/]*)$/.exec(this.mtl);\n\n          if (result) {\n            mtlPath = result[1];\n            mtlSrc = result[2];\n          }\n        }\n\n        if (mtlPath) {\n          this.mtlLoader.setPath(mtlPath);\n        }\n\n        this.mtlLoader.load(mtlSrc, (materials) => {\n          materials.preload();\n\n          this.loader\n            .setMaterials(materials)\n            .load(this.src, onLoad, onProgress, onError);\n        }, () => {}, onError);\n      } else {\n        this.loader.load(this.src, onLoad, onProgress, onError);\n      }\n    },\n  },\n};\n</script>\n"]}]}